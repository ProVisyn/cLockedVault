{% extends 'base.html' %}
{% block content %}
  <h2>Admin Dashboard</h2>
  <h3>Users (Total: {{ total_users }})</h3>
  <table border="1">
    <tr><th>Username</th><th>Email</th><th>Role</th><th>Action</th></tr>
    {% for username, email, is_admin in users %}
      <tr>
        <td>{{ username }}</td>
        <td>{{ email }}</td>
        <td>{{ 'Admin' if is_admin else 'User' }}</td>
        <td>
          {% if not is_admin %}
            <form method="POST" action="{{ url_for('promote_user') }}">
              <input type="hidden" name="promote_email" value="{{ email }}">
              <button type="submit">Promote to Admin</button>
            </form>
          {% else %}
            â€”
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </table>
  <h3>Invite Codes</h3>
  <form method="POST" action="{{ url_for('generate_invite') }}">
    <button type="submit">Generate Invite</button>
  </form>
  <table border="1">
    <tr><th>Code</th><th>Used</th><th>Created By</th><th>Created At</th></tr>
    {% for code, used, by, at in invites %}
      <tr>
        <td>{{ code }}</td>
        <td>{{ 'Yes' if used else 'No' }}</td>
        <td>{{ by }}</td>
        <td>{{ at }}</td>
      </tr>
    {% endfor %}
  </table>
  <h3>Pending Requests</h3>
  <table border="1">
    <tr><th>ID</th><th>Requester</th><th>Action</th><th>Target</th><th>Description</th><th>Created At</th><th>Approve</th><th>Deny</th></tr>
    {% for rid, requester, action_type, target, description, created_at in requests %}
      <tr>
        <td>{{ rid }}</td>
        <td>{{ requester }}</td>
        <td>{{ action_type }}</td>
        <td>{{ target }}</td>
        <td>{{ description }}</td>
        <td>{{ created_at }}</td>
        <td><a href="{{ url_for('review_request', req_id=rid, decision='approve') }}">Approve</a></td>
        <td><a href="{{ url_for('review_request', req_id=rid, decision='deny') }}">Deny</a></td>
      </tr>
    {% endfor %}
  </table>
  <h3>Activity Logs (Recent 100)</h3>
  <table border="1">
    <tr><th>User</th><th>Action</th><th>Path</th><th>Timestamp</th></tr>
    {% for user, action, path, timestamp in logs %}
      <tr>
        <td>{{ user }}</td>
        <td>{{ action }}</td>
        <td>{{ path }}</td>
        <td>{{ timestamp }}</td>
      </tr>
    {% endfor %}
  </table>
  <h3>Analytics</h3>
  <p>Total Users: {{ total_users }}</p>
  <p>Total Storage Used: {{ total_storage }} bytes</p>
{% endblock %}